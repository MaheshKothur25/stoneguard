<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/utils/utils.js | @pawjs/pawjs</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A minimal pluggable reactjs framework to develop a progressive web application"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="@pawjs/pawjs"><meta property="twitter:description" content="A minimal pluggable reactjs framework to develop a progressive web application"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/Atyantik/pawjs"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server">server</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-afterStart">afterStart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-beforeStart">beforeStart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-server">server</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateMeta">generateMeta</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getTextFromHtml">getTextFromHtml</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-trimTillLastSentence">trimTillLastSentence</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-assetsToArray">assetsToArray</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateStringHash">generateStringHash</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isBrowser">isBrowser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loadScript">loadScript</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loadStyle">loadStyle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-possibleStandardNames">possibleStandardNames</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-metaKeys">metaKeys</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#webpack">webpack</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/webpack/handler.js~WebpackHandler.html">WebpackHandler</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/utils/utils.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import _ from &apos;lodash&apos;;

/**
 * Check if current script is running in browser or not
 * @returns {boolean}
 */
export const isBrowser = () =&gt; typeof window !== &apos;undefined&apos; &amp;&amp; typeof document !== &apos;undefined&apos;;

const loadPromises = {};

/**
 * Simple numeric hash of a string, used for non-secure usage only
 * @param str
 * @param namespace
 * @returns {string}
 */
export const generateStringHash = (str, namespace) =&gt; {
  const nmspace = namespace || &apos;&apos;;
  let hash = 0; let i; let
    chr;
  if (str.length === 0) return `${nmspace}__${hash}`;
  const strr = `${nmspace}_${str}`;
  for (i = 0; i &lt; strr.length; i += 1) {
    chr = strr.charCodeAt(i);
    // eslint-disable-next-line
    hash = ((hash &lt;&lt; 5) - hash) + chr;
    // eslint-disable-next-line
    hash |= 0; // Convert to 32bit integer
  }
  return `${nmspace}__${hash}`;
};

/**
 * Load stylesheet
 * @param path
 * @returns {Promise}
 */
export const loadStyle = (path) =&gt; {
  const pathHash = generateStringHash(path, &apos;CSS&apos;);

  if (loadPromises[pathHash]) return loadPromises[pathHash];

  loadPromises[pathHash] = new Promise((resolve, reject) =&gt; {
    if (!isBrowser()) {
      return reject(new Error(&apos;Cannot call from server. Function can be executed only from browser&apos;));
    }


    // Do not load css if already loaded
    const previousLink = document.getElementById(pathHash.toString());
    if (previousLink) {
      resolve();
      return previousLink;
    }

    const head = document.getElementsByTagName(&apos;head&apos;)[0];
    // reference to document.head for appending/ removing link nodes

    const link = document.createElement(&apos;link&apos;); // create the link node

    link.setAttribute(&apos;href&apos;, path);
    link.setAttribute(&apos;id&apos;, pathHash.toString());
    link.setAttribute(&apos;rel&apos;, &apos;stylesheet&apos;);
    link.async = true;
    link.defer = true;
    link.setAttribute(&apos;type&apos;, &apos;text/css&apos;);

    let sheet; let
      cssRules;
    // get the correct properties to check for depending on the browser
    if (&apos;sheet&apos; in link) {
      sheet = &apos;sheet&apos;;
      cssRules = &apos;cssRules&apos;;
    } else {
      sheet = &apos;styleSheet&apos;;
      cssRules = &apos;rules&apos;;
    }

    // start checking whether the style sheet has successfully loaded
    const intervalId = setInterval(() =&gt; {
      try {
        // SUCCESS! our style sheet has loaded
        if (link[sheet] &amp;&amp; link[sheet][cssRules].length) {
          // clear the counters
          clearInterval(intervalId);

          // Declared after &quot;,&quot; so it will be available in Interval
          // eslint-disable-next-line
          clearTimeout(timeoutId);
          resolve();
        }
      } catch (e) {
        // Do nothing, timeout will handle it for fail after 15 seconds
      }
    }, 10);

    // how often to check if the stylesheet is loaded
    // start counting down till fail

    let timeoutId = setTimeout(() =&gt; {
      // clear the counters
      clearInterval(intervalId);
      clearTimeout(timeoutId);

      // since the style sheet didn&apos;t load, remove the link node from the DOM
      head.removeChild(link);
      return reject(new Error(&apos;Timeout, unable to load css file&apos;));
      // how long to wait before failing
    }, 15000);

    // insert the link node into the DOM and start loading the style sheet

    head.appendChild(link);
    // return the link node;
    return link;
  });
  return loadPromises[pathHash];
};

/**
 * Load javascript file by path
 * @param path
 * @param attributes
 * @returns {Promise}
 */
export const loadScript = (path, attributes = {}) =&gt; {
  const pathHash = generateStringHash(path, &apos;JS&apos;).toString();
  if (loadPromises[pathHash]) return loadPromises[pathHash];

  loadPromises[pathHash] = new Promise((resolve, reject) =&gt; {
    if (!isBrowser()) {
      // If not a browser then do not allow loading of
      // css file, return with success-&gt;false
      return reject(new Error(&apos;Cannot call from server. Function can be executed only from browser&apos;));
    }


    // Do not load script if already loaded
    const previousLink = document.getElementById(pathHash);
    if (previousLink) {
      resolve();
      return previousLink;
    }

    let r;
    r = false;
    const s = document.createElement(&apos;script&apos;);
    s.type = &apos;text/javascript&apos;;
    s.id = pathHash;
    s.src = path;
    s.defer = true;
    // eslint-disable-next-line
    s.onload = s.onreadystatechange = function () {
      if (!r &amp;&amp; (!this.readyState || this.readyState === &apos;complete&apos;)) {
        r = true;
        resolve();
      }
    };
    // Add custom attribute added by user
    Object.keys(attributes).forEach((attr) =&gt; {
      s[attr] = attributes[attr];
    });
    const t = document.getElementsByTagName(&apos;script&apos;)[0];
    t.parentNode.insertBefore(s, t);
    return s;
  });
  return loadPromises[pathHash];
};


/**
 * Return assets as array
 * @param assets
 * @returns {Array}
 */
export const assetsToArray = (assets) =&gt; {
  let allAssets = [];
  if (assets instanceof Object) {
    _.each(assets, (a) =&gt; {
      if (typeof a === &apos;string&apos;) {
        allAssets.push(a);
      } else if (a instanceof Object) {
        allAssets = allAssets.concat(assetsToArray(a));
      }
    });
  } else if (typeof assets === &apos;string&apos;) {
    allAssets.push(assets);
  }
  allAssets = _.sortBy(allAssets, a =&gt; a.indexOf(&apos;hot-update&apos;) !== -1);
  return _.uniq(allAssets);
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
